<!DOCTYPE html>
<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>PROFILE</title>
	<script src="functions.js"></script>
	<style type="text/css">
		html, body{
			margin: 0;
			height: 100%;
			background-image: url("Images/background-1.jpg");
		}
		body{
			background-repeat: no-repeat;
			background-size: 100% 100%;
		}
		ul{
			display: flex;
			list-style-type: none;
			padding: 0px
		}
		li{
			color: white;
			font-size: 20px;
			margin: 10px;
			width: 150px;
			text-align: center;
			background: linear-gradient(to bottom, #ccff99 -37%, #333300 100%);
		}
		div>p{
			margin:  10px 0px 0px 0px;
			font-size: 20px;
			color: white;
		}
		input{
			margin: 0px auto;
			font-size: 20px;
			width: 90%;
			border-radius: 10px;
			padding: 5px;
			color: black;
			background-color: white;
		}
		img{
			width: 250px;
			height: 300px;
		}
		#mainContentDiv{
			display: flex;
			width: 97%;
			margin: 0px auto;
			padding: 10px;
			background: rgb(61, 57, 11, 0.5)
		}
		#mainContentDiv>div>div{
			display: inline-block;
			width: 450px;
			margin-left: 10px;
		}
		#mainContentDiv>div>input::-webkit-outer-spin-button,
		#mainContentDiv>div>input::-webkit-inner-spin-button {
		    -webkit-appearance: none;
		    margin: 0; /* <-- Apparently some margin are still there even though it's hidden */
		}
		#mainContentDiv>div>input[type=number] {
		    -moz-appearance:textfield; /* Firefox */
		}
		#editLogBtn>button{
			width: 200px;
			height: 40px;
			border-radius: 12px;
			color: white;
			font: small-caps bold 16px;
		}
		#loadingPage{			
		  display: none; /* Hidden by default */
		  position: fixed; /* Stay in place */
		  z-index: 1; /* Sit on top */
		  left: 0;
		  top: 0;
		  width: 100%; /* Full width */
		  height: 100%; /* Full height */
		  overflow: none; /* Enable scroll if needed */
		  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
		}

		.headerFont{
			color: white;
			font: small-caps bold 40px;
			text-align: center;
		}


		@media (max-width: 1280px){
			img{
				display: block;
				margin: 0px auto;
			}
			#mainContentDiv{
				display: block;
			}		
			#mainContentDiv>div>div{
				width: 48%;
			}
		}


		@media (max-width: 900px){
			input{
				width: 96%;
			}
			#mainContentDiv>div{
				width: 80%;
				margin: 0px auto;
				padding: 2%;
			}
			#mainContentDiv>div>div{
				display: block;
				width: 80%;
				margin: 0px auto;
			}
			#editLogBtn{
				text-align: center;
			}
		}


		@media (max-width: 700px){
			#navigationBarDiv{
				flex-direction: column;
			}
			#navigationBarDiv>button{
				display: block;
				width: 300px;
				margin: 0px auto !important;
			}			
			#navigationBarDiv>ul>li{
				text-align: center;
			}
			#imageDiv{
				text-align: center;
				width: 100%;
				border: black red 1px;
			}		
			#mainContentDiv>div{
				width: 90%;
			}
			input{
				width: 100%;
				font-size: 16px;
			}
			li{
				font-size: 14px;
				margin: 6px;
			}
		}
	</style>
</head>
<body onload="bodyLoad()">
	<div id="loadingPage" style="display: block; z-index: 3">
		<!-- <img src="https://i.gifer.com/7Fmb.gif" style="opacity: 1; width: 100px; height: 100px; border-radius: 50%;"> -->
		<img src="Images/loadingPage.gif" style="width: 100%; height: 100%; border-radius: 0px;">
	</div>

	<p id="greetings" style="color: white; font-size: 20px">Hello</p>
	<h1 class="headerFont">SS19 LIBRARY</h1>
	<div id="navigationBarDiv">
		<ul>
			<li onclick="window.location.href = 'userHomepage.html'">Homepage</li>
			<li onclick="window.location.href = 'userBooks.html'">Books</li>
			<li onclick="window.location.href = 'userProfile.html'">Profile</li>
			<li onclick="window.location.href = 'userHowToUse.html'">How To Use</li>
		</ul>
	</div>
	<div id="mainContentDiv">
		<div id="imageDiv">
			<!-- <img src="https://images.ctfassets.net/g8qtv9gzg47d/6SiUg4TCwLA9OfEy3KlQy7/41c90a47f0250d130323056f69f6cdca/5de2bba479d7577cd722e553.jpeg?fl=progressive&fm=jpg&q=80"> -->
			<img src="https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_1280.png" id="profilePict">
		</div>
		<div>
			<div>
				<p>Name</p>
				<input type="text" name="name" disabled="true">
			</div>
			<div>
				<p>Phone Number</p>
				<input type="number" name="phoneNum" disabled="true">
			</div>
			<div>
				<p>Address</p>
				<input type="text" name="address" disabled="true">
			</div>
			<div>
				<p>Postcode</p>
				<input type="number" name="postcode" disabled="true">
			</div>
			<div>
				<p>City</p>
				<input type="text" name="city" disabled="true">
			</div>
			<div>
				<p>State</p>
				<input type="text" name="state" disabled="true">
			</div>
			<div>
				<p>Country</p>
				<input type="text" name="country" disabled="true">
			</div>
			<div id="editLogBtn">
				<button onclick="editBtnFunc()" id="editBtn" style="background: linear-gradient(to bottom, #ffff00 -50%, #ff9900 100%); margin: 20px auto;">Edit</button>
				<button onclick="logoutBtnFunc()" style="background-color: red">Log Out</button>
			</div>
		</div>
	</div>

<script type="text/javascript">	
	var databaseLink = "https://libraryss19.herokuapp.com"
	// var databaseLink = "http://libraryss19.test"
	var userData = JSON.parse(sessionStorage.getItem('userData'))	
	console.log(userData)
	if(userData == null){
		window.location.href = "logintest.html";
	}
	document.getElementById('greetings').innerHTML = "Hello "+userData.name	
	var memberId = userData.id
	
	function bodyLoad(){
		console.log("body loaded")
		setTimeout(function(){
			document.getElementById("loadingPage").style.display = "none"
		}, 1000)		
	}


	function loadMemberData(){
		data = userData
		// fetch(databaseLink+'/api/member/'+memberId, {
		// 	method: 'GET', // or 'PUT'
		// 	headers: {
		// 		'Content-Type': 'application/json',
		// 	}
		// })
		// .then(response => response.json())
		// .then(data => {
		// 	console.log('Success:', data);
		// 	var data = data[1][0]

		// 	document.getElementsByName('name')[0].value	= data.name
		// 	document.getElementsByName('phoneNum')[0].value	= data.phoneNum
		// 	document.getElementsByName('address')[0].value	= data.address
		// 	document.getElementsByName('postcode')[0].value	= data.postcode
		// 	document.getElementsByName('city')[0].value	= data.city
		// 	document.getElementsByName('state')[0].value	= data.state
		// 	document.getElementsByName('country')[0].value	= data.country
		// })
		// .catch((error) => {
		// 	console.error('Error:', error);
		// });
		if(data.profilePict == null){
			document.getElementById('profilePict').setAttribute('src', 'https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_1280.png')
		}else{
			document.getElementById('profilePict').setAttribute('src', databaseLink+'/api/get-profile-pict/'+data.profilePict.split('/')[1])
		}

		document.getElementsByName('name')[0].value	= data.name
		document.getElementsByName('phoneNum')[0].value	= data.phoneNum
		document.getElementsByName('address')[0].value	= data.address
		document.getElementsByName('postcode')[0].value	= data.postcode
		document.getElementsByName('city')[0].value	= data.city
		document.getElementsByName('state')[0].value	= data.state
		document.getElementsByName('country')[0].value	= data.country
	}loadMemberData()


	function editBtnFunc(){
		document.getElementsByName('name')[0].disabled = false
		document.getElementsByName('phoneNum')[0].disabled = false
		document.getElementsByName('address')[0].disabled = false
		document.getElementsByName('postcode')[0].disabled = false
		document.getElementsByName('city')[0].disabled = false
		document.getElementsByName('state')[0].disabled = false
		document.getElementsByName('country')[0].disabled = false

		document.getElementById('editBtn').textContent = "Save"
		document.getElementById('editBtn').setAttribute('onclick', 'saveBtnFunc()')
	}


	function saveBtnFunc(){
		console.log("save button clicked")
		const data = {
			id: memberId,
			name: capitalize(document.getElementsByName('name')[0].value),
			phoneNum: document.getElementsByName('phoneNum')[0].value,
			address: document.getElementsByName('address')[0].value,
			postcode: document.getElementsByName('postcode')[0].value,
			city: capitalize(document.getElementsByName('city')[0].value),
			state: capitalize(document.getElementsByName('state')[0].value),
			country: capitalize(document.getElementsByName('country')[0].value)
		};
		fetch(databaseLink+'/api/edit-member', {
			method: 'PUT', // or 'PUT'
			headers: {
				'Content-Type': 'application/json',
			},
			body: JSON.stringify(data),
		})
		.then(response => response.json())
		.then(data => {
			console.log('Success:', data);

			sessionStorage.setItem('userData', JSON.stringify(data[1][0]))

			document.getElementsByName('name')[0].disabled = true
			document.getElementsByName('phoneNum')[0].disabled = true
			document.getElementsByName('address')[0].disabled = true
			document.getElementsByName('postcode')[0].disabled = true
			document.getElementsByName('city')[0].disabled = true
			document.getElementsByName('state')[0].disabled = true
			document.getElementsByName('country')[0].disabled = true

			document.getElementById('editBtn').textContent = "Edit"
			document.getElementById('editBtn').setAttribute('onclick', 'editBtnFunc()')
		})
		.catch((error) => {
			console.error('Error:', error);
		});
	}


	function logoutBtnFunc(){
		console.log("Log out Btn clicked")
		sessionStorage.removeItem('userData');
		window.location.href = "logintest.html";
	}
	// const data = { username: 'example' };
	// fetch('https://example.com/profile', {
	// 	method: 'POST', // or 'PUT'
	// 	headers: {
	// 		'Content-Type': 'application/json',
	// 	},
	// 	body: JSON.stringify(data),
	// })
	// .then(response => response.json())
	// .then(data => {
	// 	console.log('Success:', data);
	// })
	// .catch((error) => {
	// 	console.error('Error:', error);
	// });

</script>

</body>
</html>